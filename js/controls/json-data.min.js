!function(){"use strict";var u=[];var p={data:{url:"",isLoading:!1,isLoaded:!1,hasError:!1,errorMessage:null,modelProp:null,refreshTimeInterval:null,intervalID:null,clickSelector:null,graphqlId:null,graphqlSrc:null,graphqlQuery:null,errorTextGraphQLErrors:"{count} GraphQL Errors occured. See console for full details.",loadOnlyOnce:!1,vueInstance:null,vueApp:null},onFetch:null,onError:null,fetchData:function(l,n){var r,e,t=this,s=null,a=null,i=app.activeController&&"Vue"===app.activeController.viewEngine;function d(){Object.assign(app.activeVueModel,{isLoading:t.isLoading,isLoaded:t.isLoaded,hasError:t.hasError,errorMessage:t.errorMessage})}function o(r,e){var a=null===t.vueInstance?t:t.vueInstance;if(a.isLoading=!1,a.isLoaded=!0,a.hasError=!1,a.errorMessage=null,a.graphqlQuery){if(i?(d(),Object.assign(app.activeVueModel,r)):null===s?Object.assign(a,r.data):(Object.assign(s,t),Object.assign(s,r.data)),r.errors&&r.errors.length){var o=1===r.errors.length&&r.errors[0].message?"[GraphQL Error]: "+r.errors[0].message:a.errorTextGraphQLErrors.replace("{count}",r.errors.length);throw o}}else i?(d(),Object.assign(app.activeVueModel,r)):null===s?Object.assign(a,r):(Object.assign(s,t),Object.assign(s,r));p.renderControl(l,a),null!==p.onFetch&&p.onFetch.call(a,l,e),void 0!==n&&n()}if(!t.isLoading&&(t.isLoading=!0,t.isLoaded=!1,t.hasError=!1,i?d():null!==t.modelProp&&(app.activeModel[t.modelProp]=app.activeModel[t.modelProp]||{},s=app.activeModel[t.modelProp],Object.assign(s,t)),p.renderControl(l,t),t.graphqlQuery?(r=t.url?t.url:app.settings.graphqlUrl,e=app.buildGraphQLVariables(t.graphqlQuery,app.activeModel),a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t.graphqlQuery,variables:e})}):(r=app.buildUrl(t.url,app.activeModel),e=r),""!==r)){if(t.loadOnlyOnce){var c=function(r,e,a){for(var o=0,l=u.length;o<l;o++){var n=u[o];if(n.url===r&&n.query===e&&n.params===a)return n.data}return null}(t.url,t.graphqlQuery,e);if(null!==c)return void o(c,!0)}app.fetch(r,a).then(function(r){if("object"!=typeof r&&null!==r)throw new TypeError("Invalid Response type. Received data in format of ["+typeof r+"]");o(r,!1),t.loadOnlyOnce&&function(r,e,a,o){for(var l=0,n=u.length;l<n;l++){var t=u[l];if(t.url===r&&t.query===e)return t.params=a,t.data=o}u.push({url:r,query:e,params:a,data:o})}(t.url,t.graphqlQuery,e,r)}).catch(function(r){var e=null===t.vueInstance?t:t.vueInstance;e.isLoading=!1,e.isLoaded=!1,e.hasError=!0,e.errorMessage=r,i?d():null!==s&&Object.assign(s,e),p.renderControl(l,e,r),null!==p.onError&&p.onError.call(e,l),void 0!==n&&n()})}},renderControl:function(r,e,a){var o,l;l=e,null!==(o=r).querySelector(".is-loading, is-loaded, .has-error")&&(app.loadCss("dataformsjs-control-json-data",".dataformsjs-control-loading > .is-loaded { display:none; } .dataformsjs-control-loading > .has-error { display:none; } .dataformsjs-control-loaded > .is-loading { display:none; } .dataformsjs-control-loaded > .has-error { display:none; } .dataformsjs-control-error > .is-loading { display:none; } .dataformsjs-control-error > .is-loaded { display:none; } .data-control-not-loaded > .has-error, .data-control-not-loaded > .is-loading, .data-control-not-loaded > .is-loaded { display:none; }"),o.classList.remove("data-control-not-loaded"),o.classList.remove("dataformsjs-control-loading"),o.classList.remove("dataformsjs-control-error"),o.classList.remove("dataformsjs-control-loaded"),l.isLoading?o.classList.add("dataformsjs-control-loading"):l.isLoaded?o.classList.add("dataformsjs-control-loaded"):l.hasError&&o.classList.add("dataformsjs-control-error")),app.activeController&&"Vue"===app.activeController.viewEngine||null!==e.vueInstance?void 0===a?null!==e.vueInstance?e.vueInstance.$nextTick(app.refreshPlugins):app.refreshPlugins():app.showError(r,a):null!==app.activeModel||void 0===window.Vue||null!==e.vueInstance||null!==e.vueApp?null!==r.getAttribute("data-template-id")||null!==r.getAttribute("data-template-url")?null===e.modelProp?app.refreshHtmlControl(r,void 0,e):app.refreshHtmlControl(r):(null!==e.clickSelector&&0===r.children.length?app.refreshAllHtmlControls(function(){app.refreshPlugins()}):app.refreshPlugins(r),void 0!==a&&app.showError(r,a)):"function"==typeof Vue.createApp?(e.vueApp=Vue.createApp({data:function(){return e},directives:app.vueDirectives,mounted:function(){e.vueInstance=this}}),e.vueApp.mount(r)):e.vueInstance=new Vue({el:r,data:e})},onLoad:function(e){var a=this;this.graphqlId||this.graphqlSrc?(this.url||(this.url=app.settings.graphqlUrl),app.getGraphQL(a.graphqlId,a.graphqlSrc).then(function(r){a.graphqlQuery=r,p.setupControl(a,e)}).catch(function(r){app.showErrorAlert(r),p.setupControl(a,e)})):p.setupControl(a,e)},setupControl:function(r,e){var a,o;null===r.clickSelector?null===e.getAttribute("click-selector")?(p.fetchData.call(r,e),null!==r.refreshTimeInterval&&(r.intervalID=window.setInterval(function(){p.fetchData.call(r,e)},r.refreshTimeInterval))):e.classList.add("data-control-not-loaded"):null===(a=document.querySelector(r.clickSelector))?(o="Element not found for <json-data> Control using [data-click-selector]: "+String(r.clickSelector),app.showErrorAlert(o)):a.addEventListener("click",function(){"boolean"==typeof a.disabled&&(a.disabled=!0),p.fetchData.call(r,e,function(){"boolean"==typeof a.disabled&&(a.disabled=!1)})})},onUnload:function(){null!==this.intervalID&&window.clearInterval(this.intervalID)}};app.addControl("json-data",p)}();