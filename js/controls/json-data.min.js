!function(){"use strict";var u=[];function n(r,e){null!==r.querySelector(".is-loading, .is-loaded, .has-error, is-loading, is-loaded, has-error")&&(app.loadCss("dataformsjs-control-json-data",".dataformsjs-control-loading:not(.dataformsjs-control-loaded) > .is-loaded { display:none; } .dataformsjs-control-loading:not(.dataformsjs-control-error) > .has-error { display:none; } .dataformsjs-control-loaded:not(.dataformsjs-control-loading) > .is-loading { display:none; } .dataformsjs-control-loaded:not(.dataformsjs-control-error) > .has-error { display:none; } .dataformsjs-control-error:not(.dataformsjs-control-loading) > .is-loading { display:none; } .dataformsjs-control-error:not(.dataformsjs-control-loaded) > .is-loaded { display:none; } .data-control-not-loaded > .has-error, .data-control-not-loaded > .is-loading, .data-control-not-loaded > .is-loaded { display:none; }"),r.classList.remove("data-control-not-loaded"),r.classList.remove("dataformsjs-control-loading"),r.classList.remove("dataformsjs-control-error"),r.classList.remove("dataformsjs-control-loaded"),e.isLoading&&r.classList.add("dataformsjs-control-loading"),e.hasError&&r.classList.add("dataformsjs-control-error"),e.isLoaded&&r.classList.add("dataformsjs-control-loaded"))}var p={data:{url:"",isLoading:!1,isLoaded:!1,hasError:!1,errorMessage:null,modelProp:null,refreshTimeInterval:null,intervalID:null,clickSelector:null,graphqlId:null,graphqlSrc:null,graphqlQuery:null,errorTextGraphQLErrors:"{count} GraphQL Errors occured. See console for full details.",loadOnlyOnce:!1,transformData:null,vueInstance:null,vueApp:null},onFetch:null,onError:null,fetchData:function(t,n){var r,e,l=this,s=null,o=null,d=app.activeController&&"Vue"===app.activeController.viewEngine;function i(){Object.assign(app.activeVueModel,{isLoading:l.isLoading,isLoaded:l.isLoaded,hasError:l.hasError,errorMessage:l.errorMessage})}function a(r,e){var o=null===l.vueInstance?l:l.vueInstance;if(o.isLoading=!1,o.isLoaded=!0,o.hasError=!1,o.errorMessage=null,o.transformData)try{if("function"!=typeof window[o.transformData])throw new Error("Function ["+o.transformData+"()] was not found.");if("object"!=typeof(r=window[o.transformData](r))||null===r)throw new Error("Function ["+o.transformData+"()] must return an object.")}catch(r){o.isLoaded=!1,o.hasError=!0,o.errorMessage=r.message}if(o.graphqlQuery){if(d?(i(),Object.assign(app.activeVueModel,r)):null===s?Object.assign(o,r.data):(Object.assign(s,l),Object.assign(s,r.data)),r.errors&&r.errors.length){var a=1===r.errors.length&&r.errors[0].message?"[GraphQL Error]: "+r.errors[0].message:o.errorTextGraphQLErrors.replace("{count}",r.errors.length);throw a}}else d?(i(),Object.assign(app.activeVueModel,r)):null===s?Object.assign(o,r):(Object.assign(s,l),Object.assign(s,r));p.renderControl(t,o),null!==p.onFetch&&p.onFetch.call(o,t,e),void 0!==n&&n()}if(!l.isLoading&&(l.isLoading=!0,l.isLoaded=!1,l.hasError=!1,d?i():null!==l.modelProp&&(app.activeModel[l.modelProp]=app.activeModel[l.modelProp]||{},s=app.activeModel[l.modelProp],Object.assign(s,l)),p.renderControl(t,l),l.graphqlQuery?(r=l.url?l.url:app.settings.graphqlUrl,e=app.buildGraphQLVariables(l.graphqlQuery,app.activeModel),o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:l.graphqlQuery,variables:e})}):(r=app.buildUrl(l.url,app.activeModel),e=r),""!==r)){if(l.loadOnlyOnce){var c=function(r,e,o){for(var a=0,t=u.length;a<t;a++){var n=u[a];if(n.url===r&&n.query===e&&n.params===o)return n.data}return null}(l.url,l.graphqlQuery,e);if(null!==c)return void a(c,!0)}app.fetch(r,o).then(function(r){if("object"!=typeof r&&null!==r)throw new TypeError("Invalid Response type. Received data in format of ["+typeof r+"]");a(r,!1),l.loadOnlyOnce&&function(r,e,o,a){for(var t=0,n=u.length;t<n;t++){var l=u[t];if(l.url===r&&l.query===e)return l.params=o,l.data=a}u.push({url:r,query:e,params:o,data:a})}(l.url,l.graphqlQuery,e,r)}).catch(function(r){var e=null===l.vueInstance?l:l.vueInstance;e.isLoading=!1,e.isLoaded=!1,e.hasError=!0,e.errorMessage=r,d?i():null!==s&&Object.assign(s,e),p.renderControl(t,e,r),null!==p.onError&&p.onError.call(e,t),void 0!==n&&n()})}},renderControl:function(r,e,o){n(r,e),app.activeController&&"Vue"===app.activeController.viewEngine||null!==e.vueInstance?void 0===o?null!==e.vueInstance?e.vueInstance.$nextTick(app.refreshPlugins):app.refreshPlugins():app.showError(r,o):null!==app.activeModel||void 0===window.Vue||null!==e.vueInstance||null!==e.vueApp?null!==r.getAttribute("data-template-id")||null!==r.getAttribute("data-template-url")?null===e.modelProp?app.refreshHtmlControl(r,void 0,e):app.refreshHtmlControl(r):(null!==e.clickSelector&&0===r.children.length?app.refreshAllHtmlControls(function(){app.refreshPlugins()}):app.refreshPlugins(r),void 0!==o&&app.showError(r,o)):"function"==typeof Vue.createApp?(e.vueApp=Vue.createApp({data:function(){return e},directives:app.vueDirectives,mounted:function(){e.vueInstance=this}}),e.vueApp.mount(r)):e.vueInstance=new Vue({el:r,data:e})},onLoad:function(e){var o=this;this.graphqlId||this.graphqlSrc?(this.url||(this.url=app.settings.graphqlUrl),app.getGraphQL(o.graphqlId,o.graphqlSrc).then(function(r){o.graphqlQuery=r,p.setupControl(o,e)}).catch(function(r){app.showErrorAlert(r),p.setupControl(o,e)})):p.setupControl(o,e)},setupControl:function(r,e){var o=e.querySelectorAll(".is-loading[data-template-selector], .has-error[data-template-selector], .is-loaded[data-template-selector]");if(Array.prototype.forEach.call(o,function(r){var e,o=r.getAttribute("data-template-selector");o&&0===r.childNodes.length&&((e=document.querySelector(o))?e.content&&e.content.cloneNode?r.appendChild(e.content.cloneNode(!0)):r.innerHTML=e.innerHTML:app.showError(r,'Error - Could not find template from [data-template-selector="'+o+'"]>.'))}),null!==r.clickSelector){var a,t=document.querySelector(r.clickSelector);return null===t?(a="Element not found for <json-data> Control using [data-click-selector]: "+String(r.clickSelector),app.showErrorAlert(a)):t.addEventListener("click",function(){"boolean"==typeof t.disabled&&(t.disabled=!0),p.fetchData.call(r,e,function(){"boolean"==typeof t.disabled&&(t.disabled=!1)})}),n(e,r),void e.classList.add("data-control-not-loaded")}if(null!==e.getAttribute("click-selector"))return n(e,r),void e.classList.add("data-control-not-loaded");p.fetchData.call(r,e),null!==r.refreshTimeInterval&&(r.intervalID=window.setInterval(function(){p.fetchData.call(r,e)},r.refreshTimeInterval))},onUnload:function(){null!==this.intervalID&&window.clearInterval(this.intervalID)}};app.addControl("json-data",p)}();