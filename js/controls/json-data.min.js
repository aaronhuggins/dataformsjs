!function(){"use strict";var d={data:{url:"",isLoading:!1,isLoaded:!1,hasError:!1,errorMessage:null,modelProp:null,refreshTimeInterval:null,intervalID:null,clickSelector:null,graphqlId:null,graphqlSrc:null,graphqlQuery:null,errorTextGraphQLErrors:"{count} GraphQL Errors occured. See console for full details.",vueInstance:null,vueApp:null},onFetch:null,onError:null,fetchData:function(o,l){var e,n=this,t=null,r=null,s=app.activeController&&"Vue"===app.activeController.viewEngine;function i(){Object.assign(app.activeVueModel,{isLoading:n.isLoading,isLoaded:n.isLoaded,hasError:n.hasError,errorMessage:n.errorMessage})}n.isLoading||(n.isLoading=!0,n.isLoaded=!1,n.hasError=!1,s?i():null!==n.modelProp&&(app.activeModel[n.modelProp]=app.activeModel[n.modelProp]||{},t=app.activeModel[n.modelProp],Object.assign(t,n)),d.renderControl(o,n),n.graphqlQuery?(e=n.url?n.url:app.settings.graphqlUrl,r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n.graphqlQuery,variables:app.buildGraphQLVariables(n.graphqlQuery,app.activeModel)})}):e=app.buildUrl(n.url,app.activeModel),app.fetch(e,r).then(function(e){if("object"!=typeof e&&null!==e)throw new TypeError("Invalid Response type. Received data in format of ["+typeof e+"]");var r=null===n.vueInstance?n:n.vueInstance;if(r.isLoading=!1,r.isLoaded=!0,r.hasError=!1,r.errorMessage=null,r.graphqlQuery){if(s?(i(),Object.assign(app.activeVueModel,e)):null===t?Object.assign(r,e.data):(Object.assign(t,n),Object.assign(t,e.data)),e.errors&&e.errors.length){var a=1===e.errors.length&&e.errors[0].message?"[GraphQL Error]: "+e.errors[0].message:r.errorTextGraphQLErrors.replace("{count}",e.errors.length);throw a}}else s?(i(),Object.assign(app.activeVueModel,e)):null===t?Object.assign(r,e):(Object.assign(t,n),Object.assign(t,e));d.renderControl(o,r),null!==d.onFetch&&d.onFetch.call(r,o),void 0!==l&&l()}).catch(function(e){var r=null===n.vueInstance?n:n.vueInstance;r.isLoading=!1,r.isLoaded=!1,r.hasError=!0,r.errorMessage=e,s?i():null!==t&&Object.assign(t,r),d.renderControl(o,r,e),null!==d.onError&&d.onError.call(r,o),void 0!==l&&l()}))},renderControl:function(e,r,a){var o,l;l=r,null!==(o=e).querySelector(".is-loading, is-loaded, .has-error")&&(app.loadCss("dataformsjs-control-json-data",".dataformsjs-control-loading .is-loaded { display:none; } .dataformsjs-control-loading .has-error { display:none; } .dataformsjs-control-loaded .is-loading { display:none; } .dataformsjs-control-loaded .has-error { display:none; } .dataformsjs-control-error .is-loading { display:none; } .dataformsjs-control-error .is-loaded { display:none; }"),o.classList.remove("dataformsjs-control-loading"),o.classList.remove("dataformsjs-control-error"),o.classList.remove("dataformsjs-control-loaded"),l.isLoading?o.classList.add("dataformsjs-control-loading"):l.isLoaded?o.classList.add("dataformsjs-control-loaded"):l.hasError&&o.classList.add("dataformsjs-control-error")),app.activeController&&"Vue"===app.activeController.viewEngine||null!==r.vueInstance?void 0===a?null!==r.vueInstance?r.vueInstance.$nextTick(app.refreshPlugins):app.refreshPlugins():app.showError(e,a):null!==app.activeModel||void 0===window.Vue||null!==r.vueInstance||null!==r.vueApp?null!==e.getAttribute("data-template-id")||null!==e.getAttribute("data-template-url")?null===r.modelProp?app.refreshHtmlControl(e,void 0,r):app.refreshHtmlControl(e):void 0===a?app.refreshPlugins(e):app.showError(e,a):"function"==typeof Vue.createApp?(r.vueApp=Vue.createApp({data:function(){return r},directives:app.vueDirectives,mounted:function(){r.vueInstance=this}}),r.vueApp.mount(e)):r.vueInstance=new Vue({el:e,data:r})},onLoad:function(r){var a=this;this.graphqlId||this.graphqlSrc?(this.url||(this.url=app.settings.graphqlUrl),app.getGraphQL(a.graphqlId,a.graphqlSrc).then(function(e){a.graphqlQuery=e,d.setupControl(a,r)}).catch(function(e){app.showErrorAlert(e),d.setupControl(a,r)})):d.setupControl(a,r)},setupControl:function(e,r){var a,o;null===e.clickSelector?(d.fetchData.call(e,r),null!==e.refreshTimeInterval&&(e.intervalID=window.setInterval(function(){d.fetchData.call(e,r)},e.refreshTimeInterval))):null===(a=document.querySelector(e.clickSelector))?(o="Element not found for <json-data> Control using [data-click-selector]: "+String(e.clickSelector),app.showErrorAlert(o)):a.addEventListener("click",function(){"boolean"==typeof a.disabled&&(a.disabled=!0),d.fetchData.call(e,r,function(){"boolean"==typeof a.disabled&&(a.disabled=!1)})})},onUnload:function(){null!==this.intervalID&&window.clearInterval(this.intervalID)}};app.addControl("json-data",d)}();