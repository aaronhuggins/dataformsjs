!function(){"use strict";var s=!1;function d(t,e){if(void 0===window.hljs)return s?t:"";if(e&&hljs.getLanguage(e))try{return hljs.highlight(e,t).value}catch(t){console.warn(t)}try{return hljs.highlightAuto(t).value}catch(t){console.warn(t)}return s?t:""}var i=[];var c={data:{bind:null,content:null,url:null,loadingSelector:null,showSource:!1,errorMessage:null,linkTarget:null,linkRel:null,linkRootUrl:null,loadOnlyOnce:!1},onLoad:function(t,e){var r;void 0===Object.getOwnPropertyDescriptor(t,"url")&&(Object.defineProperty(t,"url",{get:function(){return this.getAttribute("data-url")},set:function(t){this.url!==t&&(this.setAttribute("data-url",t),app.loadJsControl(this))}}),Object.defineProperty(t,"showSource",{get:function(){return this.hasAttribute("data-show-source")},set:function(t){this.showSource!==t&&(t?this.setAttribute("data-show-source",""):this.removeAttribute("data-show-source"),app.loadJsControl(this))}}),t.clearContent=function(){t.innerHTML="",c.dispatchRendered(t)}),this.url?c.fetch.call(this,t):((r=t.querySelector('script[type="text/markdown"]'))?this.content=r.innerHTML:this.bind&&(this.content=e&&e[this.bind]?e[this.bind]:null,null===this.content&&void 0!==app.plugins.dataBind&&"function"==typeof app.plugins.dataBind.getBindValue&&(this.content=app.plugins.dataBind.getBindValue(this.bind,e))),c.render.call(this,t))},dispatchRendered:function(t){var e,r="app:markdownRendered";"function"==typeof Event?e=new Event(r,{bubbles:!0}):(e=document.createEvent("Event")).initEvent(r,!0,!1),t.dispatchEvent(e)},fetch:function(e){if(this.loadOnlyOnce){var t=function(t){for(var e=0,r=i.length;e<r;e++)if(t===i[e].url)return i[e];return null}(this.url);if(t)return this.content=t.content,this.errorMessage=t.errorMessage,void c.render.call(this,e)}this.loadingSelector&&((t=document.querySelector(this.loadingSelector))?e.innerHTML=t.innerHTML:console.warn('Could not find template from <markdown-content [loading-selector="'+this.loadingSelector+'"]>.'));var r=this,n=this.url;app.fetch(n,null,"text/plain").then(function(t){r.content=t,r.errorMessage=null,c.render.call(r,e)}).catch(function(t){t="Error loading markdown content from ["+n+"]. Error: "+t;r.errorMessage=t,c.render.call(r,e)}).finally(function(){r.loadOnlyOnce&&function(t,e,r){100<i.length&&(i.length=0);for(var n=0,o=i.length;n<o;n++)if(t===i[n].url)return;i.push({url:t,content:e,errorMessage:r})}(n,r.content,r.errorMessage)})},render:function(t){if(this.errorMessage)return app.showError(t,this.errorMessage),void c.dispatchRendered(t);if(null!==this.content){var e,r,n=t.querySelector('script[type="text/markdown"]');if(n&&n.parentNode.removeChild(n),this.showSource)return t.innerHTML="<pre></pre>",t.querySelector("pre").textContent=this.content,n&&t.appendChild(n),void c.dispatchRendered(t);if(s=!1,window.marked)s=!0,marked.setOptions({highlight:d}),e=marked(this.content);else if(window.markdownit)r=markdownit({html:!0,linkify:!0,typographer:!0,highlight:d}),window.markdownitEmoji&&r.use(markdownitEmoji),e=r.render(this.content);else{if(!window.remarkable)return app.showError(t,"Error - Unable to show Markdown content because a Markdown JavaScript library was not found on the page."),void c.dispatchRendered(t);e=(r=new remarkable.Remarkable({html:!0,typographer:!0,highlight:d}).use(remarkable.linkify)).render(this.content)}void 0!==window.DOMPurify&&(e=DOMPurify.sanitize(e)),t.innerHTML=e,n&&t.appendChild(n),void 0!==window.hljs&&(n=t.querySelectorAll('code[class*="language-"]'),Array.prototype.forEach.call(n,function(t){t.classList.add("hljs")}));var o=this.linkTarget,i=this.linkRel;(o||i)&&(a=t.querySelectorAll("a"),Array.prototype.forEach.call(a,function(t){t.target=o||t.target,t.rel=i||t.rel}));var a,l=this.linkRootUrl;l&&(a=t.querySelectorAll('a:not([href^="http:"]):not([href^="https:"])'),Array.prototype.forEach.call(a,function(t){var e=t.getAttribute("href");t.setAttribute("data-original-href",e),t.setAttribute("href",l+e)})),c.dispatchRendered(t)}else t.innerHTML=""}};app.addControl("markdown-content",c).loadCss("dataformsjs-control-markdown-content","markdown-content[data-control] { display:block; }")}();