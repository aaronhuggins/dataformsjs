import{isAttachedToDom,defineExtendsPolyfill}from"./utils.min.js";class InputFilter extends HTMLInputElement{constructor(){super(),this.addEventListener("input",this.filter)}connectedCallback(){if(!this.hasAttribute("filter-results-selector"))return void this.filter();let t=0;const e=window.setInterval(()=>{const{elements:s}=this.getElementsToFilter();0===s.length&&t<10?t++:(window.clearInterval(e),isAttachedToDom(this)&&this.filter())},100)}getElementsToFilter(){let t=null,e=null,s=document.querySelectorAll(this.getAttribute("filter-selector"));if(1===s.length&&"TABLE"===s[0].tagName){const l=s[0];switch(l.tBodies.length){case 0:s=[];break;case 1:s=l.tBodies[0].rows,t=l.getAttribute("data-sort-class-odd"),e=l.getAttribute("data-sort-class-even");break;default:console.warn("Unexpected Table format for Filter Plugin. Only 1 <tbody> element is supported.")}}return{elements:s,cssOdd:t,cssEven:e}}filter(){const t=this.value.toLowerCase().split(" "),e=t.length,s=0!==e;let l=0;const{elements:r,cssOdd:n,cssEven:i}=this.getElementsToFilter(),o=i&&n;for(const c of r){let r=!0;if(s){const s=c.textContent.toLowerCase();for(let l=0;l<e;l++)if(""!==t[l]&&!s.includes(t[l])){r=!1;break}}r&&(l++,o&&(l%2==0?(c.classList.add(i),c.classList.remove(n)):(c.classList.add(n),c.classList.remove(i)))),c.style.display=r?"":"none"}const c=this.getAttribute("filter-results-selector");if(c){const t=document.querySelector(c);if(!t)return void console.warn("Defined [filter-results-selector] but element not found");const e=this.getAttribute("filter-results-text-all"),s=this.getAttribute("filter-results-text-filtered");if(!e)return void console.warn("Defined [filter-results-selector] without [filter-results-text-all]");if(!s)return void console.warn("Defined [filter-results-selector] without [filter-results-text-filtered]");let n;const i=r.length;n=(n=l===i?e:s.replace(/{displayCount}/g,l)).replace(/{totalCount}/g,i);const o=document.querySelector("url-router");o&&"object"==typeof o.currentUrlParams&&(n=n.replace(/{(.+)}/g,function(t,e){return void 0!==o.currentUrlParams[e]?String(o.currentUrlParams[e]):t})),t.textContent=n}}}window.customElements.define("input-filter",InputFilter,{extends:"input"}),defineExtendsPolyfill("input-filter","input",t=>{t.addEventListener("input",InputFilter.prototype.filter)});