import{showError,componentsAreDefined,usingWebComponentsPolyfill}from"./utils.min.js";import{shadowTmpl,setupRouting,downloadTemplate,setView,routeMatches,showFatalError,lazyLoadScripts}from"./utils-router.js";class UrlRouter extends HTMLElement{constructor(){if(super(),usingWebComponentsPolyfill())return;this.attachShadow({mode:"open"}).appendChild(shadowTmpl.content.cloneNode(!0)),this._currentRoute=null,this.updateView=this.updateView.bind(this),this.updateView()}connectedCallback(){window.addEventListener("popstate",this.updateView)}disconnectedCallback(){window.removeEventListener("popstate",this.updateView)}get currentRoute(){return this._currentRoute}async updateView(){await componentsAreDefined(this,"url-route"),this._currentRoute=null;const t=setupRouting(this);let e=window.location.pathname;""===e&&(e="/");const r=this.querySelectorAll("url-route");let o=null;for(const n of r){if(null===n.path)return showFatalError(this,"Error, element <url-route> is missing attribute [path]"),void console.log(n);const r=routeMatches(e,n.path);if(r.isMatch){const e=n.redirect;if(null!==e&&e!==window.location.pathname)return window.history.pushState(null,null,n.redirect),void this.updateView();await lazyLoadScripts(n);const o=n.template;return this._currentRoute=n,void(null===o?downloadTemplate(this,t,n,r.urlParams):setView(this,t,o,r.urlParams))}n.isDefault&&(o=n)}if(o){const t=o.path;if(""!==t&&-1===t.indexOf(":"))return window.history.pushState(null,null,t),void this.updateView()}showError(t,`Error - The route [${e}] does not have a matching <url-route> element and no default route is defined using [default-route].`)}}class UrlRoute extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).appendChild(shadowTmpl.content.cloneNode(!0))}get path(){return this.getAttribute("path")}get src(){return this.getAttribute("src")}get redirect(){return this.getAttribute("redirect")}get isDefault(){return null!==this.getAttribute("default-route")}get template(){const t=this.querySelector("template");return null===t?null:t.innerHTML}set template(t){let e=this.querySelector("template");null===e&&(e=document.createElement("template"),this.appendChild(e)),e.innerHTML=t}}window.customElements.define("url-router",UrlRouter),window.customElements.define("url-route",UrlRoute);