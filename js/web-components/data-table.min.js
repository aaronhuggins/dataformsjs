import{render,buildUrl,usingWebComponentsPolyfill,polyfillCustomElements}from"./utils.min.js";import{Format}from"./utils-format.min.js";const shadowTmpl=document.createElement("template");function toggleHighlight(t){const e=t.target.nodeName;"A"!==e&&"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e&&"BUTTON"!==e&&this.classList.toggle("highlight")}shadowTmpl.innerHTML="\n    <style>\n        :host { display: block; }\n        :host([hidden]) { display: none; }\n    </style>\n    <slot></slot>\n";class DataTable extends HTMLElement{constructor(){if(super(),usingWebComponentsPolyfill())return;this.attachShadow({mode:"open"}).appendChild(shadowTmpl.content.cloneNode(!0)),this.setAttribute("not-setup",""),this.state={list:null,hasBeenLoaded:!1}}static get observedAttributes(){return["col-link-template","col-link-fields","col-class","columns","labels","table-attr","highlight-class"]}attributeChangedCallback(t,e){if(void 0!==this.state)switch(t){case"col-link-template":case"col-link-fields":case"col-class":case"columns":case"labels":case"table-attr":case"highlight-class":case"empty-data-text":(null!==e||this.state.hasBeenLoaded)&&this.renderTable()}}get value(){return this.state.list}set value(t){this.state.list=t,this.renderTable()}get errorClass(){return this.getAttribute("error-class")}get defaultErrorStyle(){return"color:white; background-color:red; padding:0.5rem 1rem; margin:.5rem;"}get emptyDataText(){const t=this.getAttribute("empty-data-text");return null===t?"No records found":t}getTemplate(){let t=this.querySelector("template");return null===t&&(t=this.querySelector('script[type="text/x-template"]')),t}removeTable(){if(null===this.getTemplate())return void(this.innerHTML="");const t=this.querySelector("table");null!==t&&t.parentNode.removeChild(t)}renderTable(){const t=this.state.list;if(null===t||""===t)return void this.removeTable();this.state.hasBeenLoaded=!0;const e=this.getTemplate(),s=t=>{null===e?this.innerHTML=t:(this.removeTable(),this.insertAdjacentHTML("beforeend",t)),this.removeAttribute("not-setup")};if(Array.isArray(t)&&0===t.length)return void s(render`<table class="no-data"><caption>${this.emptyDataText}</caption></table>`);let r=!0;if(Array.isArray(t)?t.length>0&&"object"!=typeof t[0]&&(r=!1):r=!1,!r)return void s('<table><caption class="error">Error invalid data type for table</caption></table>');const l=this.getAttribute("columns"),i=l?l.split(",").map(t=>t.trim()):Object.keys(t[0]);let n=i,o=this.getAttribute("labels");o&&(n=o.split(",").map(t=>t.trim())).length!==i.length&&null===e&&(n=i);let a="<table",h=this.getAttribute("table-attr");if(h){h=h.split(",").map(t=>t.trim());for(const t of h){const e=t.indexOf("=");if(e>1){a+=render` ${t.substr(0,e).trim()}="${t.substr(e+1).trim()}"`}else a+=render` ${t}`}}const c=this.getAttribute("col-class"),d=[];if(d.push(`${a}><thead><tr>`),c){const t=c.split(",").map(t=>t.trim()),e={};for(const s of t){const t=s.indexOf("=");if(t>0){const r=s.substr(0,t),l=s.substr(t+1);e[r]=l}}for(let t=0,s=n.length;t<s;t++){const s=n[t];let r;void 0!==e[t.toString()]?r=e[t.toString()]:void 0!==e[s]&&(r=e[s]),r?d.push(render`<th class="${r}">${s}</th>`):d.push(render`<th>${s}</th>`)}}else for(const t of n)d.push(render`<th>${t}</th>`);if(d.push("</tr></thead>"),d.push("<tbody>"),e)try{const r=new Function("item","index","render","format","with(item){return render`"+e.innerHTML+"`}");let l=0;const n=new Format;for(const e of t){try{d.push(r(e,l,render,n))}catch(t){this.errorClass?d.push(render`<tr class="${this.errorClass}">`):d.push(render`<tr style="${this.defaultErrorStyle}">`),d.push(render`<td colspan="${i.length}">Item Error - ${t.message}</td></tr>`)}l++}}catch(t){return void s(this.errorClass?`<table class="${this.errorClass}"><caption>Error Rendering Template - ${t.message}</caption></table>`:`<table style="${this.defaultErrorStyle}"><caption>Error Rendering Template - ${t.message}</caption></table>`)}else{const e=this.getAttribute("col-link-template");let s=this.getAttribute("col-link-fields");e&&(s=s?s.split(",").map(t=>t.trim()):[i[0]]);for(const r of t){const t=[];t.push("<tr>");for(const l of i)e&&s.includes(l)?t.push(render`<td>
                            <a href="${buildUrl(e,r)}">${r[l]}</a>
                        </td>`):t.push(render`<td>${r[l]}</td>`);t.push("</tr>"),d.push(t.join(""))}}if(d.push("</tbody></table>"),s(d.join("")),this.getAttribute("highlight-class")){const t=this.querySelectorAll("tbody tr");for(const e of t)e.style.cursor="pointer",e.addEventListener("click",toggleHighlight)}polyfillCustomElements(this)}}window.customElements.define("data-table",DataTable);