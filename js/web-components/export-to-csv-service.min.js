import{WebComponentService}from"./WebComponentService.min.js";import{showErrorAlert}from"./utils.min.js";function csvEscape(e){return(e=e.replace(/"/g,'""')).search(/("|,|\n|:)/g)>=0&&(e='"'+e+'"'),e}function exportTable(e){let t=e.target.getAttribute("data-export-csv-selector"),o=e.target.getAttribute("data-export-file-name");o=o||"Report.csv";const n=document.querySelector(t),l=[];let r=[],s=n.tHead.rows[0];for(let e=0,t=s.cells.length;e<t;e++)r.push(csvEscape(s.cells[e].textContent));l.push(r.join(","));const c=n.tBodies[0].rows;for(let e=0,t=c.length;e<t;e++){r=[],s=c[e];for(let e=0,t=s.cells.length;e<t;e++){const t=s.cells[e];let o=t.getAttribute("data-value");null===o&&(o=t.textContent),r.push(csvEscape(o))}l.push(r.join(","))}const a=l.join("\r\n"),i=new Blob([a],{type:"text/csv; charset=utf-8;"});if(void 0!==navigator.msSaveBlob)navigator.msSaveBlob(i,o);else{const e=document.createElement("a");if(void 0!==e.download){const t=URL.createObjectURL(i);e.setAttribute("href",t),e.setAttribute("download",o),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else{showErrorAlert("Unable to Export as a CSV File. Try a different browser and if you need help then please contact support.")}}}window.customElements.define("export-to-csv-service",class extends WebComponentService{onLoad(e){const t=e.nodeName;("URL-ROUTE"===t||t.includes("-SERVICE"))&&(e=document);const o=document.querySelectorAll("[data-export-csv-selector]");let n=!1;if(o.length>0){let e=document.querySelector("a");null===e&&(e=document.createElement("a")),n=void 0!==navigator.msSaveBlob||void 0!==e.download}for(const e of o)n?e.addEventListener("click",exportTable):e.style.display="none"}});