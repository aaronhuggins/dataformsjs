import{WebComponentService}from"./WebComponentService.min.js";import{showErrorAlert,setElementText}from"./utils.min.js";class I18nService extends WebComponentService{constructor(){function t(t,e,n=null){const i=t.getAttribute(e);return i||n}super(),this.fileName=t(this,"file","_"),this.fileDir=t(this,"file-dir","i18n"),this.defaultLocale=t(this,"default-locale"),this.supportedLocales=t(this,"locales","").split(",").map(t=>t.trim()),this.currentLocale=null,this.langText={},this.langCache={},this._isRunning=!1}refresh(t){if(this._isRunning)return;this._isRunning=!0,this.currentLocale=null;const e=document.querySelector("url-router");(null===e||!0!==e.useHistoryMode)&&(0===window.location.hash.indexOf("#/")?this.currentLocale=window.location.hash.split("/")[1]:window.location.pathname.split("/").length>1&&(this.currentLocale=window.location.pathname.split("/")[1])),document.documentElement.lang=this.currentLocale;const n=this.fileDir+"/"+this.fileName+"."+this.currentLocale+".json",i=[this.downloadFile(n)];Promise.all(i).finally(()=>{this.langText=this.langCache[n],this.updateElements(t),this._isRunning=!1})}getText(t){return this.langText&&this.langText[t]?this.langText[t]:t}downloadFile(t){return void 0!==this.langCache[t]?new Promise(t=>{t()}):fetch(t,{cache:"no-store",credentials:"same-origin"}).then(t=>{const e=t.status;if(e>=200&&e<300||304===e)return Promise.resolve(t);{const n=`Error loading data. Server Response Code: ${e}, Response Text: ${t.statusText}`;return Promise.reject(n)}}).then(t=>t.json()).then(e=>{this.langCache[t]=e}).catch(e=>{showErrorAlert(`Error Downloading I18N file: [${t}], Response Code Status: ${e.message}`),this.langCache[t]={}})}updateElements(t){let e=t.querySelectorAll("[data-i18n]");for(const t of e){const e=t.getAttribute("data-i18n"),n=void 0===this.langText[e]?"":this.langText[e];setElementText(t,n)}e=t.querySelectorAll("[data-i18n-attr]");for(const t of e){const e=t.getAttribute("data-i18n-attr").split(",").map(function(t){return t.trim()});for(let n=0,i=e.length;n<i;n++){const i=e[n],s=t.getAttribute(i);null!==s&&t.setAttribute(i,this.langText[s]?this.langText[s]:s)}}e=t.querySelectorAll("a[data-i18n-href]");for(const t of e){const e=t.getAttribute("href").split("/");e.length>1&&(e[1]=this.currentLocale,t.href=e.join("/"))}}}window.customElements.define("i18n-service",I18nService);