// @link https://www.dataformsjs.com
// @version 4.8.0
// @author Conrad Sollitt (https://conradsollitt.com)
// @license MIT
import{showError,componentsAreDefined,usingWebComponentsPolyfill}from"./utils.min.js";import{shadowTmpl,setupRouting,downloadTemplate,setView,routeMatches,showFatalError,lazyLoadScripts}from"./utils-router.js";class UrlHashRouter extends HTMLElement{constructor(){if(super(),usingWebComponentsPolyfill())return;this.attachShadow({mode:"open"}).appendChild(shadowTmpl.content.cloneNode(!0)),this.currentRoute=null,this.updateView=this.updateView.bind(this),this.updateView()}connectedCallback(){window.addEventListener("hashchange",this.updateView)}disconnectedCallback(){window.removeEventListener("hashchange",this.updateView)}async updateView(){await componentsAreDefined(this,"url-hash-route"),this.currentRoute=null;const t=setupRouting(this);let e=window.location.hash;0===e.indexOf("#")&&(e=e.substr(1)),""===e&&(e="/");const o=this.querySelectorAll("url-hash-route");let r=null;for(const n of o){if(null===n.path)return showFatalError(this,"Error, element <url-hash-route> is missing attribute [path]"),void console.log(n);const o=routeMatches(e,n.path);if(o.isMatch){const e=n.redirect;if(null!==e&&e!==window.location.pathname)return void(window.location.hash="#"+e);await lazyLoadScripts(n);const r=n.template;return this.currentRoute=n,void(null===r?downloadTemplate(this,t,n,o.urlParams):setView(this,t,r,o.urlParams))}n.isDefault&&(r=n)}if(r){const t=r.path;if(""!==t&&-1===t.indexOf(":"))return void(window.location.hash="#"+r.path)}showError(t,`Error - The route [${e}] does not have a matching <url-hash-route> element and no default route is defined using [default-route].`)}}class UrlHashRoute extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).appendChild(shadowTmpl.content.cloneNode(!0))}get path(){return this.getAttribute("path")}get src(){return this.getAttribute("src")}get redirect(){return this.getAttribute("redirect")}get isDefault(){return null!==this.getAttribute("default-route")}get template(){const t=this.querySelector("template");return null===t?null:t.innerHTML}set template(t){let e=this.querySelector("template");null===e&&(e=document.createElement("template"),this.appendChild(e)),e.innerHTML=t}}window.customElements.define("url-hash-router",UrlHashRouter),window.customElements.define("url-hash-route",UrlHashRoute);