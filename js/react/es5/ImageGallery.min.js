"use strict";var React;function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var i=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,i?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}void 0===window.exports&&(window.exports=window),void 0===window.React&&void 0!==window.preact&&(React=window.preact),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){return _supportsPassive=!0}});window.addEventListener("testPassive",null,opts),window.removeEventListener("testPassive",null,opts)}catch(e){}function BasicImage(e){return React.createElement("img",{src:e.thumbnail,alt:e.title,onClick:e.onClick})}var ImageGallery=function(){_inherits(i,React.Component);var n=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=n.call(this,e)).onClick=t.onClick.bind(_assertThisInitialized(t)),t.handleDocKeyDown=t.handleDocKeyDown.bind(_assertThisInitialized(t)),t.preloadNextImages=t.preloadNextImages.bind(_assertThisInitialized(t)),t.hideOverlay=t.hideOverlay.bind(_assertThisInitialized(t)),t.changeImage=t.changeImage.bind(_assertThisInitialized(t)),t.overlayStyleId="image-gallery-css",t.overlayStyleCss="\n            body.blur { filter: blur(3px); }\n\n            .image-gallery-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background-color: rgba(255,255,255,.8);\n                cursor: pointer;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n            }\n\n            .image-gallery-overlay img {\n                max-width: 100%;\n                max-height: 100%;\n            }\n        ",t.imageIndex=null,t.overlay=null,t.overlayImg=null,t.touchStartX=null,t.state={images:e.images},t}return _createClass(i,[{key:"onClick",value:function(e){var t=(t=e.target.src)||e.target.getAttribute("data-image");this.imageIndex=-1;for(var n=0,i=this.state.images.length;n<i;n++)if(this.state.images[n].thumbnail===t){this.imageIndex=n;break}this.showOverlay()}},{key:"loadCss",value:function(){var e=document.getElementById(this.overlayStyleId);null===e&&((e=document.createElement("style")).id=this.overlayStyleId,e.innerHTML=this.overlayStyleCss,document.head.appendChild(e))}},{key:"showOverlay",value:function(){this.loadCss(),this.overlay=document.createElement("div"),this.overlay.className="image-gallery-overlay",this.overlayImg=document.createElement("img"),this.overlayImg.addEventListener("load",this.preloadNextImages),this.overlayImg.src=this.state.images[this.imageIndex].image,this.overlay.appendChild(this.overlayImg),this.addOverlayEvents(),document.documentElement.appendChild(this.overlay),document.querySelector("body").classList.add("blur")}},{key:"addOverlayEvents",value:function(){var n=this;this.overlay.onclick=this.hideOverlay,document.addEventListener("keydown",this.handleDocKeyDown),this.overlay.addEventListener("touchstart",function(e){n.touchStartX=e.changedTouches[0].screenX},!!_supportsPassive&&{passive:!0}),this.overlay.addEventListener("touchend",function(e){var t=e.changedTouches[0].screenX;t>n.touchStartX?n.changeImage("left"):t<n.touchStartX&&n.changeImage("right")})}},{key:"handleDocKeyDown",value:function(e){switch(e.key){case"ArrowLeft":this.changeImage("left");break;case"ArrowRight":this.changeImage("right");break;case"Escape":this.hideOverlay()}}},{key:"hideOverlay",value:function(){this.overlay.parentNode.removeChild(this.overlay),this.overlayImg=null,this.overlay=null,document.removeEventListener("keydown",this.handleDocKeyDown),document.querySelector("body").classList.remove("blur")}},{key:"preloadNextImages",value:function(){var e,t,n;-1!==window.Image.toString().indexOf("[native code]")?(e=this.state.images.length,-1===(t=this.imageIndex-1)&&(t=e-1),t!==this.imageIndex&&((new Image).src=this.state.images[t].image),(n=this.imageIndex+1)===e&&(n=0),n!==this.imageIndex&&((new Image).src=this.state.images[n].image)):console.warn("Images for <ImageGallery> cannot be preloaded because the app defined a <Image> component that overwrote the browsers native [Image] class.")}},{key:"changeImage",value:function(e){var t=this.state.images.length;this.imageIndex="right"===e?this.imageIndex===t-1?0:this.imageIndex+1:0===this.imageIndex?t-1:this.imageIndex-1,this.overlayImg.src="",this.overlayImg.src=this.state.images[this.imageIndex].image}},{key:"render",value:function(){var t=this,n=this.props.template;return void 0===n&&(n=void 0!==this.props.children?this.props.children:React.createElement(BasicImage)),this.state.images.map(function(e){return React.cloneElement(n,Object.assign({},e,{onClick:t.onClick}))})}}]),i}();exports.default=ImageGallery;